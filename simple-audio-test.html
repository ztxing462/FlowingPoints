<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>简单音频测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; text-align: center; }
        h1 { color: #333; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; cursor: pointer; }
        #status { margin-top: 20px; padding: 15px; background: #f0f0f0; min-height: 50px; }
        pre { text-align: left; margin: 20px auto; max-width: 800px; text-align: center; }
    </style>
</head>
<body>
    <h1>简单音频加载测试</h1>
    
    <div id="audioContainer">
        <audio id="simpleAudio" controls style="margin: 20px 0;">
           </audio>
a
    </div>
    
    <div>
        <button id="loadBtn">加载音频</button>
        <button id="playBtn">播放</button>
        <button id="pauseBtn">暂停</button>
    </div>
    
    <div id="status">
        <p>准备就绪</p>
    </div>
    
    <div>
        <h3>控制台日志:</h3>
        <pre id="consoleLog"></pre>
    </div>

    <script>
        const audio = document.getElementById('simpleAudio');
        const loadBtn = document.getElementById('loadBtn');
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const status = document.getElementById('status');
        const consoleLog = document.getElementById('consoleLog');
        
        let logs = [];
        
        function log(message) {
            console.log(message);
            logs.push(new Date().toLocaleTimeString() + ': ' + message);
            if (logs.length > 20) logs.shift();
            consoleLog.textContent = logs.join('\n');
        }
        
        function updateStatus(text) {
            status.innerHTML = '<p>' + text + '</p>';
        }
        
        // 添加所有可能的事件监听器
        const events = ['loadstart', 'loadedmetadata', 'loadeddata', 'progress', 'canplay', 
                        'canplaythrough', 'play', 'pause', 'ended', 'timeupdate', 
                        'volumechange', 'waiting', 'seeking', 'seeked', 'error', 'abort'];
        
        events.forEach(event => {
            audio.addEventListener(event, () => {
                log(`事件触发: ${event}`);
                if (event === 'error') {
                    log(`错误代码: ${audio.error ? audio.error.code : '未知'}`);
                    log(`错误消息: ${audio.error ? getErrorMessage(audio.error.code) : '未知'}`);
                    updateStatus('音频加载失败: ' + getErrorMessage(audio.error ? audio.error.code : -1));
                } else if (event === 'canplay') {
                    updateStatus('音频已准备好播放');
                } else if (event === 'play') {
                    updateStatus('音频正在播放');
                } else if (event === 'pause') {
                    updateStatus('音频已暂停');
                }
            });
        });
        
        function getErrorMessage(code) {
            switch(code) {
                case MediaError.MEDIA_ERR_ABORTED:
                    return '加载被中止';
                case MediaError.MEDIA_ERR_NETWORK:
                    return '网络错误';
                case MediaError.MEDIA_ERR_DECODE:
                    return '解码错误';
                case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:
                    return '格式不支持';
                default:
                    return '未知错误';
            }
        }
        
        // 按钮事件
        loadBtn.addEventListener('click', () => {
            updateStatus('正在加载音频文件...');
            log('开始加载音频文件');
            
            // 尝试直接设置src
            audio.src = 'bgm/lovely.mp3';
            audio.crossOrigin = 'anonymous';
            
            // 强制加载
            audio.load();
        });
        
        playBtn.addEventListener('click', () => {
            log('尝试播放音频');
            audio.play().then(() => {
                log('播放成功');
            }).catch(error => {
                log('播放失败: ' + error.message);
                updateStatus('播放失败: ' + error.message);
            });
        });
        
        pauseBtn.addEventListener('click', () => {
            audio.pause();
        });
        
        // 初始状态
        updateStatus('点击"加载音频"按钮开始测试');
        log('页面已加载完成');
    </script>
</body>
</html>